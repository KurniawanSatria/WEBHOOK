<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="utf-8">
<title>Susun Kata | MiyaBot</title>
<link rel="stylesheet" href="/games/susunkata/style.css">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/games/susunkata/words.js" defer></script>
</head>
<body>
<div class="container">
<h2>Susun Kata</h2>
<div class="content">
<p class="word"></p>
<div class="details">
<p class="hint">Petunjuk: <span></span></p>
<p class="time">Waktu Tersisa: <span><b>30</b>&nbsp;detik</span></p>
</div>
<p id="phoneDisplay">Nomor WhatsApp Kamu: Tidak ada</p>
<button id="changePhoneBtn">Ubah Nomor WhatsApp</button>
<input type="text" spellcheck="false" placeholder="Ketik Jawabanmu Disini">
<div class="buttons">
<button class="refresh-word">Perbarui Kata</button>
<button class="check-word">Cek Kata</button>
</div>
</div>
</div>
<script>
const wordText = document.querySelector('.word'),hintText = document.querySelector('.hint span'),timeText = document.querySelector('.time b'),inputField = document.querySelector('input'),refreshBtn = document.querySelector('.refresh-word'),checkBtn = document.querySelector('.check-word'),phoneDisplay = document.getElementById('phoneDisplay'),changePhoneBtn = document.getElementById('changePhoneBtn');
let correctWord, timer;

const updatePhoneDisplay = () => {
const phoneNumber = localStorage.getItem('phoneNumber');
phoneDisplay.innerText = phoneNumber ? `Nomor WhatsApp Kamu: ${phoneNumber}` : 'Nomor WhatsApp Kamu: Tidak ada';
}

if (!localStorage.getItem('phoneNumber')) {
(async () => {
const { value: phoneNumber } = await Swal.fire({
title: 'Masukkan Nomor WhatsApp Kamu',
input: 'text',
inputLabel: 'Nomor WhatsApp Kamu',
inputPlaceholder: '08xxxxxxxxxx',
showCancelButton: false
});
if (!phoneNumber) return;
localStorage.setItem('phoneNumber', phoneNumber);
updatePhoneDisplay();
})();
} else updatePhoneDisplay();

changePhoneBtn.addEventListener('click', async () => {
const { value: phoneNumber } = await Swal.fire({
title: 'Ubah Nomor WhatsApp Kamu',
input: 'text',
inputLabel: 'Nomor WhatsApp Baru',
inputPlaceholder: '08xxxxxxxxxx',
showCancelButton: true
});
if (!phoneNumber) return;
localStorage.setItem('phoneNumber', phoneNumber);
updatePhoneDisplay();
});

const initTimer = maxTime => {
clearInterval(timer);
timer = setInterval(() => {
if(maxTime > 0) {
maxTime--;
timeText.innerText = maxTime;
} else {
Swal.fire('Waktu Habis!', `${correctWord.toUpperCase()} adalah kata yang benar`, 'error');
initGame();
}
}, 1000);
}

const initGame = () => {
initTimer(30);
let randomObj = words[Math.floor(Math.random() * words.length)];
let wordArray = randomObj.word.split('');
for (let i = wordArray.length - 1; i > 0; i--) {
let j = Math.floor(Math.random() * (i + 1));
[wordArray[i], wordArray[j]] = [wordArray[j], wordArray[i]];
}
wordText.innerText = wordArray.join('');
hintText.innerText = randomObj.hint;
correctWord = randomObj.word.toLowerCase();
inputField.value = '';
inputField.setAttribute('maxlength', correctWord.length);
}

initGame();

const checkWord = async () => {
let userWord = inputField.value.toLowerCase();
if(!userWord) return Swal.fire('Oops!', 'Masukkan kata dulu ya!', 'warning');
if(userWord !== correctWord) return Swal.fire('Salah!', `${userWord} bukan kata yang benar`, 'error');

const phoneNumber = localStorage.getItem('phoneNumber');
if (!phoneNumber) return Swal.fire('Error!', 'Kamu perlu memasukkan nomor WhatsApp dulu.', 'error');

try {
await fetch('/api/winners', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ phone: phoneNumber, game: 'Susun Kata', timestamp: new Date().toISOString() })
});
Swal.fire('Benar!', 'Selamat! Jawaban kamu benar!', 'success');
initGame();
} catch (error) {
Swal.fire('Error!', 'Gagal mengirim data ke server.', 'error');
}
}

refreshBtn.addEventListener('click', initGame);
checkBtn.addEventListener('click', checkWord);

</script>
</body>
</html>
